name: SynFlood

on:
  push:
    branches: [master]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        zig-version:
          - '0.15.0'
          - '0.15.1'
          - '0.15.2'

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install libnet
        run: sudo apt-get update && sudo apt-get install -y libnet1 libnet1-dev

      - name: Download Zig ${{ matrix.zig-version }}
        run: |
          ZIG_VERSION=${{ matrix.zig-version }}
          ZIG_URL="https://ziglang.org/download/${ZIG_VERSION}/zig-x86_64-linux-${ZIG_VERSION}.tar.xz"
          mkdir -p zig-linux-${ZIG_VERSION}
          curl -s -L "${ZIG_URL}" | tar -xJ --strip-components=1 -C zig-linux-${ZIG_VERSION}
          echo "$(pwd)/zig-linux-${ZIG_VERSION}" >> ${GITHUB_PATH}

      - name: Check Zig version
        run: zig version

      - name: Build
        run: zig build

      - name: Check help
        run: ./zig-out/bin/synflood-x86_64-linux --help
